"use strict";(self.webpackChunkpos_web_client=self.webpackChunkpos_web_client||[]).push([[835],{9835:(k,U,n)=>{n.r(U),n.d(U,{default:()=>q});var t=n(6242),u=n(6814),v=n(4240),s=n(95),y=n(8151),Z=n(9310),A=n(7394),P=n(1426),b=n(3997),l=n(2181),m=n(7398),a=n(4664);const f=(c,S)=>S.id;function p(c,S){if(1&c&&(t.TgZ(0,"div",22),t._UZ(1,"input",23),t.TgZ(2,"label",24),t._uU(3),t.qZA()()),2&c){const i=S.$implicit;t.xp6(1),t.Q6J("id",i.name),t.xp6(1),t.Q6J("for",i.name),t.xp6(1),t.hij(" ",i.name," ")}}function e(c,S){if(1&c&&(t.TgZ(0,"div",12)(1,"div",13)(2,"p",14),t._uU(3,"Categor\xedas"),t.qZA(),t.TgZ(4,"form"),t.SjG(5,p,4,3,"div",25,f),t.ALo(7,"async"),t.qZA()(),t.TgZ(8,"div",13)(9,"label",15),t._uU(10,"Existencias"),t.qZA(),t.TgZ(11,"select",16)(12,"option",17),t._uU(13,"Todos los registros"),t.qZA(),t.TgZ(14,"option",18),t._uU(15,"En existencia"),t.qZA(),t.TgZ(16,"option",19),t._uU(17,"Sin existencias"),t.qZA()()(),t.TgZ(18,"div")(19,"label",20),t._uU(20,"Estado"),t.qZA(),t.TgZ(21,"select",21)(22,"option",17),t._uU(23,"Todos los registros"),t.qZA(),t.TgZ(24,"option",18),t._uU(25,"Activo"),t.qZA(),t.TgZ(26,"option",19),t._uU(27,"Inactivo"),t.qZA()()()()),2&c){const i=t.oxw();t.wJu(5,t.lcZ(7,0,i.categories$))}}const o=c=>["edit",c];function r(c,S){if(1&c&&(t.TgZ(0,"div",26)(1,"div",27)(2,"div",28),t._uU(3),t.qZA(),t.TgZ(4,"div",6),t._uU(5),t.qZA()(),t.TgZ(6,"div",29)(7,"p",30),t._uU(8),t.ALo(9,"currency"),t.qZA(),t.TgZ(10,"div")(11,"span",31),t._uU(12),t.qZA()(),t.TgZ(13,"div")(14,"span",31),t._uU(15),t.qZA()(),t.TgZ(16,"button",32),t._uU(17,"Editar"),t.qZA()()()),2&c){const i=S.$implicit;t.xp6(3),t.Oqu(i.name),t.xp6(2),t.Oqu(i.barcode),t.xp6(3),t.Oqu(t.xi3(9,6,i.sellingPrice,"GTQ")),t.xp6(4),t.Oqu(i.inStock?"En Stock":"Sin Stock"),t.xp6(3),t.Oqu(i.isActive?"Activo":"Inactivo"),t.xp6(1),t.Q6J("routerLink",t.VKq(9,o,i.id))}}let h=(()=>{class c{constructor(){this._productService=(0,t.f3M)(v.M),this._subscriptions=new A.w0,this.categories$=(0,t.f3M)(y.H).getCategories(),this.productCount$=this._productService.getProductCount(),this.listState=[],this.diplayFilters=!1,this.searchControl=new s.NI(""),this._subscriptions.add(this.getProductList()),this._subscriptions.add(this.searchProduct()),(0,t.f3M)(t.ktI).onDestroy(()=>this._subscriptions.unsubscribe())}getProductList(){return this._productService.getProducts().subscribe(i=>{this.listState=i})}searchProduct(){return this.searchControl.valueChanges.pipe((0,P.b)(300),(0,b.x)(),(0,l.h)(i=>"string"==typeof i),(0,m.U)(i=>i),(0,a.w)(i=>""===i.trim()?this._productService.getProducts():this._productService.getProductsBy({query:i,field:"name",limit:50}))).subscribe(i=>{this.listState=i})}clearSearchQuery(){this.searchControl.setValue("")}toggleDisplayFilters(){this.diplayFilters=!this.diplayFilters}static#t=this.\u0275fac=function(d){return new(d||c)};static#e=this.\u0275cmp=t.Xpm({type:c,selectors:[["app-product-list"]],standalone:!0,features:[t.jDz],decls:22,vars:6,consts:[[1,"view-wrapper"],[1,"fs-3","mb-3"],[1,"d-flex","justify-content-between"],[1,"d-flex","mb-2","align-items-center"],["type","text","placeholder","Buscar producto",1,"form-control",3,"formControl"],[1,"btn",3,"click"],[1,"small-text"],[1,"d-flex","column-gap-2","align-items-start"],[1,"btn","btn-outline-secondary",3,"click"],["routerLink","add",1,"btn","btn-primary"],["class","mb-4"],[1,"list-group"],[1,"mb-4"],[1,"mb-3"],[1,"fw-medium","mb-1"],["for","stockSelect",1,"form-label","fw-medium"],["aria-label","Stock select","id","stockSelect",1,"form-select","form-select-sm"],["selected",""],["value","true"],["value","false"],["for","stateSelect",1,"form-label","fw-medium"],["aria-label","State select","id","stateSelect",1,"form-select","form-select-sm"],[1,"form-check"],["type","checkbox","title","category checkbox",1,"form-check-input",3,"id"],[1,"form-check-label",3,"for"],["class","form-check"],[1,"list-group-item","d-flex","justify-content-between","align-items-center"],[1,"ms-2","me-auto"],[1,"fw-medium"],[1,"d-flex","ms-3","column-gap-5","align-items-center"],[1,"mb-0"],[1,"badge","bg-success","rounded-pill"],[1,"btn",3,"routerLink"],["class","list-group-item d-flex justify-content-between align-items-center"]],template:function(d,g){1&d&&(t.TgZ(0,"div",0)(1,"h1",1),t._uU(2,"Productos"),t.qZA(),t.TgZ(3,"div")(4,"div",2)(5,"div")(6,"div",3),t._UZ(7,"input",4),t.TgZ(8,"button",5),t.NdJ("click",function(){return g.clearSearchQuery()}),t._uU(9,"Limpiar"),t.qZA()(),t.TgZ(10,"p",6),t._uU(11),t.ALo(12,"async"),t.qZA()(),t.TgZ(13,"div",7)(14,"button",8),t.NdJ("click",function(){return g.toggleDisplayFilters()}),t._uU(15," Filtrar "),t.qZA(),t.TgZ(16,"button",9),t._uU(17,"Nuevo Producto"),t.qZA()()(),t.YNc(18,e,28,2,"div",10),t.TgZ(19,"div",11),t.SjG(20,r,18,11,"div",33,f),t.qZA()()()),2&d&&(t.xp6(7),t.Q6J("formControl",g.searchControl),t.xp6(4),t.AsE(" Mostrando ",g.listState.length," resultados de ",t.lcZ(12,4,g.productCount$)," "),t.xp6(7),t.um2(18,g.diplayFilters?18:-1),t.wJu(20,g.listState))},dependencies:[u.ez,u.Ov,u.H9,s.UX,s._Y,s.YN,s.Kr,s.Fj,s.JJ,s.JL,s.oH,Z.Bz,Z.rH],styles:[".view-wrapper[_ngcontent-%COMP%]{max-width:800px;margin:0 auto}.small-text[_ngcontent-%COMP%]{font-size:14px}"]})}return c})();var T=n(2096);const w=(c,S)=>S.id;function I(c,S){if(1&c&&(t.TgZ(0,"option",22),t._uU(1),t.qZA()),2&c){const i=S.$implicit;t.Q6J("value",i.id),t.xp6(1),t.Oqu(i.name)}}let x=(()=>{class c{constructor(){this._activatedRoute=(0,t.f3M)(Z.gz),this._router=(0,t.f3M)(Z.F0),this._productService=(0,t.f3M)(v.M),this._subscriptions=new A.w0,this.categories$=(0,t.f3M)(y.H).getCategories(),this.productId=null,this.pageTitle="Crear producto",this.productForm=(0,t.f3M)(s.qu).nonNullable.group({name:["",[s.kI.required,s.kI.minLength(3)]],barcode:[""],sellingPrice:[0,[s.kI.required,s.kI.min(.01)]],categoryId:[0,[s.kI.required,s.kI.min(1)]],inStock:[!0,s.kI.required],isActive:[!0,s.kI.required]}),this._subscriptions.add(this.getProductDetails()),(0,t.f3M)(t.ktI).onDestroy(()=>this._subscriptions.unsubscribe())}getProductDetails(){return this._activatedRoute.paramMap.pipe((0,a.w)(i=>{const d=i.get("id");return d?(this.productId=parseInt(d),this.pageTitle="Editar producto",this._productService.getProductById(this.productId)):(0,T.of)(null)})).subscribe(i=>{i&&this.setInitialValues(i)})}setInitialValues(i){const{name:d,barcode:g,sellingPrice:_,categoryId:O,inStock:E,isActive:F}=i;this.productForm.setValue({name:d,barcode:g,sellingPrice:_,categoryId:O,inStock:E,isActive:F})}onSubmitForm(){if(this.productId){const i=this.productForm.getRawValue();this._productService.updateProduct(this.productId,{...i}).subscribe({next:d=>this.resetAndReturn(),error:d=>console.log(d)})}else{const i=this.productForm.getRawValue();this._productService.createProduct({...i}).subscribe({next:d=>this.resetAndReturn(),error:d=>console.log(d)})}}resetAndReturn(){this.productForm.reset(),this._router.navigateByUrl("products")}static#t=this.\u0275fac=function(d){return new(d||c)};static#e=this.\u0275cmp=t.Xpm({type:c,selectors:[["app-product-form"]],standalone:!0,features:[t.jDz],decls:46,vars:4,consts:[[1,"product-form"],[1,"fs-4","mb-4"],["autocomplete","off",3,"formGroup","ngSubmit"],[1,"mb-3"],["for","productName",1,"form-label"],["type","text","id","productName","formControlName","name",1,"form-control"],["for","barcode",1,"form-label"],["type","text","id","barcode","formControlName","barcode",1,"form-control"],["for","sellingPrice",1,"form-label"],["type","number","step","0.01","min","0.00","id","sellingPrice","formControlName","sellingPrice",1,"form-control"],["for","category",1,"form-label"],["id","category","formControlName","categoryId",1,"form-select"],["value","0"],["for","stockStatus",1,"form-label"],["id","stockStatus","formControlName","inStock",1,"form-select"],["value","false"],["value","true","selected",""],["for","productStatus",1,"form-label"],["id","productStatus","formControlName","isActive",1,"form-select"],[1,"d-flex","column-gap-2"],["type","button",1,"btn","btn-outline-secondary",3,"click"],["type","submit",1,"btn","btn-primary"],[3,"value"]],template:function(d,g){1&d&&(t.TgZ(0,"div",0)(1,"h1",1),t._uU(2),t.qZA(),t.TgZ(3,"form",2),t.NdJ("ngSubmit",function(){return g.onSubmitForm()}),t.TgZ(4,"div",3)(5,"label",4),t._uU(6,"Producto"),t.qZA(),t._UZ(7,"input",5),t.qZA(),t.TgZ(8,"div",3)(9,"label",6),t._uU(10,"C\xf3digo Barras"),t.qZA(),t._UZ(11,"input",7),t.qZA(),t.TgZ(12,"div",3)(13,"label",8),t._uU(14,"Precio Venta"),t.qZA(),t._UZ(15,"input",9),t.qZA(),t.TgZ(16,"div",3)(17,"label",10),t._uU(18,"Categor\xeda"),t.qZA(),t.TgZ(19,"select",11)(20,"option",12),t._uU(21,"Escoge una categor\xeda"),t.qZA(),t.SjG(22,I,2,2,"option",22,w),t.ALo(24,"async"),t.qZA()(),t.TgZ(25,"div",3)(26,"label",13),t._uU(27,"Inventario"),t.qZA(),t.TgZ(28,"select",14)(29,"option",15),t._uU(30,"Sin existencias"),t.qZA(),t.TgZ(31,"option",16),t._uU(32,"Con Existencias"),t.qZA()()(),t.TgZ(33,"div",3)(34,"label",17),t._uU(35,"Estado"),t.qZA(),t.TgZ(36,"select",18)(37,"option",15),t._uU(38,"Desactivado"),t.qZA(),t.TgZ(39,"option",16),t._uU(40,"Activo"),t.qZA()()(),t.TgZ(41,"div",19)(42,"button",20),t.NdJ("click",function(){return g.resetAndReturn()}),t._uU(43," Cancelar "),t.qZA(),t.TgZ(44,"button",21),t._uU(45,"Guardar cambios"),t.qZA()()()()),2&d&&(t.xp6(2),t.Oqu(g.pageTitle),t.xp6(1),t.Q6J("formGroup",g.productForm),t.wJu(22,t.lcZ(24,2,g.categories$)))},dependencies:[u.ez,u.Ov,s.UX,s._Y,s.YN,s.Kr,s.Fj,s.wV,s.EJ,s.JJ,s.JL,s.qQ,s.sg,s.u],styles:[".product-form[_ngcontent-%COMP%]{max-width:480px;width:100%;margin-left:auto;margin-right:auto}"]})}return c})();const q=[{path:"",pathMatch:"full",component:h},{path:"add",component:x},{path:"edit/:id",component:x},{path:"**",redirectTo:""}]},4240:(k,U,n)=>{n.d(U,{M:()=>P});var t=n(6242),u=n(7715),v=n(7398),s=n(5868),y=n(7845);class Z{static toEntity(l){if(!l.id)throw new Error("The id should provided to map from Dto to Entity");return{id:l.id,barcode:l.barcode,name:l.name,sellingPrice:l.selling_price,inStock:l.in_stock,isActive:l.is_active,categoryId:l.category_id}}static toDto(l){return{name:l.name,barcode:l.barcode,selling_price:l.sellingPrice,in_stock:l.inStock,is_active:l.isActive,category_id:l.categoryId}}}let P=(()=>{class b{constructor(){this._db=(0,t.f3M)(s.T).supabase}getProductCount(){return(0,u.D)(this._db.from(y.S.PRODUCTS).select("*",{count:"exact",head:!0})).pipe((0,v.U)(({count:m,error:a})=>{if(a)throw new Error(a?.message);return m||0}))}getProducts(){return(0,u.D)(this._db.from(y.S.PRODUCTS).select("*").order("id",{ascending:!0}).range(0,49)).pipe((0,v.U)(({data:m,error:a})=>{if(a)throw new Error(a.message);return m.map(f=>Z.toEntity(f))}))}getProductsBy({query:m,field:a,limit:f}){return m=function A(b){return(b=b.trim().toLowerCase()).replace(/\b\w/g,l=>l.toUpperCase())}(m),(0,u.D)(this._db.from(y.S.PRODUCTS).select("*").ilike(a,`%${m}%`).range(0,f-1)).pipe((0,v.U)(({data:p,error:e})=>{if(e)throw new Error(e.message);return p.map(o=>Z.toEntity(o))}))}getProductById(m){return(0,u.D)(this._db.from(y.S.PRODUCTS).select("*").eq("id",m)).pipe((0,v.U)(({data:a,error:f})=>{if(f)throw new Error(f.message);return Z.toEntity(a[0])}))}createProduct(m){const a=Z.toDto(m);return(0,u.D)(this._db.from(y.S.PRODUCTS).insert(a)).pipe((0,v.U)(({status:f,error:p})=>{if(p)throw new Error(p.message);return 201===f}))}updateProduct(m,a){const f=Z.toDto(a);return(0,u.D)(this._db.from(y.S.PRODUCTS).update(f).eq("id",m)).pipe((0,v.U)(({status:p,error:e})=>{if(e)throw new Error(e.message);return 204===p}))}static#t=this.\u0275fac=function(a){return new(a||b)};static#e=this.\u0275prov=t.Yz7({token:b,factory:b.\u0275fac,providedIn:"root"})}return b})()},7845:(k,U,n)=>{n.d(U,{S:()=>t});var t=function(u){return u.QUOTATIONS="quotation_header",u.QUOTATION_ITEMS="quotation_items",u.PRODUCTS="products",u.CATEGORIES="categories",u.SCHOOL_GRADES="school_grades",u.SCHOOLS="schools",u.PROMOTION_TYPE="promotion_type",u}(t||{})},1426:(k,U,n)=>{n.d(U,{b:()=>f});var t=n(7394);class u extends t.w0{constructor(e,o){super()}schedule(e,o=0){return this}}const v={setInterval(p,e,...o){const{delegate:r}=v;return r?.setInterval?r.setInterval(p,e,...o):setInterval(p,e,...o)},clearInterval(p){const{delegate:e}=v;return(e?.clearInterval||clearInterval)(p)},delegate:void 0};var s=n(9039);const Z={now:()=>(Z.delegate||Date).now(),delegate:void 0};class A{constructor(e,o=A.now){this.schedulerActionCtor=e,this.now=o}schedule(e,o=0,r){return new this.schedulerActionCtor(this,e).schedule(r,o)}}A.now=Z.now;const b=new class P extends A{constructor(e,o=A.now){super(e,o),this.actions=[],this._active=!1}flush(e){const{actions:o}=this;if(this._active)return void o.push(e);let r;this._active=!0;do{if(r=e.execute(e.state,e.delay))break}while(e=o.shift());if(this._active=!1,r){for(;e=o.shift();)e.unsubscribe();throw r}}}(class y extends u{constructor(e,o){super(e,o),this.scheduler=e,this.work=o,this.pending=!1}schedule(e,o=0){var r;if(this.closed)return this;this.state=e;const h=this.id,T=this.scheduler;return null!=h&&(this.id=this.recycleAsyncId(T,h,o)),this.pending=!0,this.delay=o,this.id=null!==(r=this.id)&&void 0!==r?r:this.requestAsyncId(T,this.id,o),this}requestAsyncId(e,o,r=0){return v.setInterval(e.flush.bind(e,this),r)}recycleAsyncId(e,o,r=0){if(null!=r&&this.delay===r&&!1===this.pending)return o;null!=o&&v.clearInterval(o)}execute(e,o){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;const r=this._execute(e,o);if(r)return r;!1===this.pending&&null!=this.id&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))}_execute(e,o){let h,r=!1;try{this.work(e)}catch(T){r=!0,h=T||new Error("Scheduled action threw falsy error")}if(r)return this.unsubscribe(),h}unsubscribe(){if(!this.closed){const{id:e,scheduler:o}=this,{actions:r}=o;this.work=this.state=this.scheduler=null,this.pending=!1,(0,s.P)(r,this),null!=e&&(this.id=this.recycleAsyncId(o,e,null)),this.delay=null,super.unsubscribe()}}});var m=n(9360),a=n(8251);function f(p,e=b){return(0,m.e)((o,r)=>{let h=null,T=null,w=null;const I=()=>{if(h){h.unsubscribe(),h=null;const C=T;T=null,r.next(C)}};function x(){const C=w+p,q=e.now();if(q<C)return h=this.schedule(void 0,C-q),void r.add(h);I()}o.subscribe((0,a.x)(r,C=>{T=C,w=e.now(),h||(h=e.schedule(x,p),r.add(h))},()=>{I(),r.complete()},void 0,()=>{T=h=null}))})}}}]);